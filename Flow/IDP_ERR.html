<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>

<head>
<script type="text/javascript" src="../h.js"></script>

<title>err</title>

<link rel=StyleSheet href="../QM-Help.css">

</head>

<body>

<h1>Handle run-time errors</h1>

<h3>Syntax1 - on error, continue</h3>

<pre class=syntax><b>err</b><i>[</i>+<i></i><i>]</i></pre>

<p>&nbsp;</p>

<h3>Syntax2 - on error, execute code and continue</h3>

<pre class=syntax><b>err</b><i>[</i>+<i></i><i>]</i>
<i class=f8>(tab)</i>statements
<i class=f8>(tab)</i><i>...</i></pre>

<p>&nbsp;</p>
<p>Can be in single line:</p>
<pre class=syntax><b>err</b><i>[</i>+<i></i><i>]</i><b> </b>statements</pre>
<p>&nbsp;</p>
<h3>Syntax3 - the beginning of code guarded by err+</h3>
<pre class=syntax><b>err</b>-</pre>
<p>&nbsp;</p>

<h3>Parameters</h3>

<h4>Options:</h4>
<table class="tflags"><col>
<tr>
<td>Default</td> <td>Handle errors of the preceding statement.</td>
</tr>
<tr>
<td>+</td> <td>Handle errors of all preceding statements (or all preceding statements 
below <span class="blue">err</span>-).</td>
</tr>
<tr>
<td>-</td> <td>Marks the beginning of the block of statements guarded by <span class="blue">err</span>+.</td>
</tr>

</table>
<p>&nbsp;</p>

<h3>Remarks</h3>

<p>Use <span class="blue">err</span> to continue macro execution when a run-time  error occurs.</p>
<p>&nbsp;</p>
<p> When an error occurs:</p>
<ul>
  <li>If the next statement is <span class="blue">err</span> or <span class="blue">err</span>+,  execution continues.</li>
  <li>Else if there is <span class="blue">err</span>+ 
    somewhere below, execution continues after it.</li>
  <li>Else if used <a href="../Commands/IDP_OPT.html">opt noerrorshere</a>, the error is passed to the caller function.</li>
  <li>Else the <a href="../Other/IDP_THREADS.html">thread</a> ends.</li>
</ul>
<p>&nbsp;</p>
<p><i>Syntax2:</i> On error executes <b>statements</b>. If no error, skips <b>statements</b>.</p>
<p>&nbsp;</p>
<p> <span class="blue">err</span> handles  errors generated by QM functions, user-defined functions  (see <A href="IDP_END.html" class="blue">end</a>) , COM functions and the OS (exceptions). It does not handle 
  some non-continuable errors, such as &quot;noncompiled function&quot;, &quot;failed constructor&quot;. It is not used to handle 
  <a href="../Language/IDP_DIR_ERR.html">compile-time errors</a>.</p>

<p>&nbsp;</p>

<p>When an error occurs, special variable _error is filled with information about 
  the error.</p>

<p>&nbsp;</p>

<pre class=cod><span class=fq>type</span> <span class=t>QMERROR</span> <span class=o>~</span>description code iid source place <span class=o>~</span>line</pre>

<p>&nbsp;</p>

<div class="parts">
<p> <b>description</b> - string that you can see in QM output when error is generated and not handled.</p>

<p> <b>code</b> - a numeric value that can be used to identify the error. Can be 0.</p>

<p> <b>iid</b> - <A href="../Functions/IDP_QMITEM.html">id of QM item</a> where 
the error is generated.</p>
<p> <b>source</b> - one of: 0 - no error, 1 - compile-time 
  error, 2 - run-time error generated by QM, 3 - run-time error generated by <A href="IDP_END.html" class="blue">end</a>, 
  4 - exception.</p>
<p><b>place</b> - offset of the statement in macro text. In <a href="../Language/IDP_DIR_SUB.html">sub-functions</a> it it is relative to parent text.</p>
<p><b>line</b> - the statement (text). Not available in exe (empty).</p>
</div>
<p>&nbsp;</p>
<p> _error has <A href="../Language/IDP_SCOPE.html">thread scope</a>, that is, 
  is accessible in all functions of that thread, including functions registered 
  to run when thread ends (<a href="IDP_ATEND.html" class="blue">atend</a>). In 
  a function registered by <span class="blue">atend</span>, _error contains error info if the thread ended 
  due to an error; it is empty (<strong>source</strong> is 0) if no error.</p>
<p>&nbsp;</p>
<p><span class="blue">err</span> handles errors generated in current macro/function 
  only. It does not handle errors generated in user-defined functions that are 
  called from current macro/function. However called functions can pass their errors 
  to the caller. There are two ways: 1. Add <span class=cod><span class=fq>opt</span> noerrorshere <span class=n>1</span></span> somewhere at the beginning (new in QM 2.3.5). 2. Add <span class=cod><span class=fq>err</span><span class=o>+</span> <span class=fq>end</span> _error</span> at the end (you can also add more code before <span class="blue">end</span>).</p>
<p>&nbsp;</p>
<p>To see possible errors, check menu Run -&gt; Compiler Options -&gt; Show possible run-time errors. Then, when you compile a macro (click Run or Compile button), it shows functions that may throw errors when the macro runs. It adds indicators in the code editor. You can Alt+click an  indicator to show the errors in QM output. This feature helps you to decide where to use <span class="blue">err</span>. Does not show <a onClick="doSection(e1)" class="expand">some errors</a>.</p>
<div id="e1" class="expand">
  <ul>
    <li>Exceptions.</li>
    <li>ERR_POINTER (&quot;invalid pointer&quot;).</li>
    <li>Type mismatch errors in automatic conversion from/to <a href="../_COM/IDP_OLETYPES.html">OLE types</a>.</li>
    <li>Errors specified in 'Show RT Errors Options' dialog.</li>
  </ul>
</div>

<p>&nbsp;</p>
<p> <i>See also</i>: <A href="../Other/IDP_ERRORS.html">Common errors</a>, <A href="../Commands/IDP_OPT.html">opt err, opt noerrorshere, opt nowarningshere</a>, <a href="../Language/IDP_SPECVAR.html">error constants</a></p>

<p>&nbsp;</p>

<h3>Examples</h3>

<pre class=cod><span class=c> Close &#34;Notepad&#34; window; ignore possible error (on error don't end macro):
</span><span class=fq>clo</span> <span class=s>&#34;Notepad&#34;</span><span class=p>;</span> <span class=fq>err</span>

<span class=c> Activate &quot;Notepad&quot; window; on error display error description:
</span><span class=fq>act</span> <span class=s>&#34;Notepad&#34;</span>
<span class=fq>err</span>
<span class=i>&#9;</span><span class=fq>out</span> _error.description

<span class=c></span><span class=c> Handle errors of all preceding statements and generate them in caller:
</span><span class=fq>err</span><span class=o>+</span> <span class=fq>end</span> _error

__________________________________

<span class=c> Loop example:
</span>
<span class=fq>out</span>
<span class=fq>run</span> <span class=s>&#34;$system$\notepad.exe&#34;</span>
<span class=n>1</span>
<span class=t>int</span> i
<span class=fq>for</span> i <span class=n>0</span> <span class=n>3</span>
<span class=i>&#9;</span><span class=fq>out</span> <span class=s>&#34;activate Notepad&#34;</span>
<span class=i>&#9;</span><span class=fq>act</span> <span class=s>&#34;Notepad&#34;</span> <span class=c2>;;throws error if Notepad not found</span>
<span class=i>&#9;</span><span class=fq>err</span> <span class=c2>;;handles the error</span>
<span class=i>&#9;&#9;</span><span class=fq>out</span> _error.description
<span class=i>&#9;&#9;</span><span class=fq>continue</span>
<span class=i>&#9;</span><span class=fq>out</span> <span class=s>&#34;close Notepad&#34;</span>
<span class=i>&#9;</span><span class=fq>clo</span> <span class=s>&#34;Notepad&#34;</span>

__________________________________

<span class=c> If macro ends due to an error, log the error to file 'My Documents\My QM\qm log.txt':
</span>
<span class=c> Insert this at the beginning of each macro that needs error logging:
</span><span class=fq>atend</span> <span class=fu>LogErrors</span>

<span class=c> And create function LogErrors:
</span><span class=fq>if</span><span class=p>(</span>_error.source<span class=p>)</span> <span class=c2>;;macro ended due to an error
</span><span class=i>&#9;</span><span class=t>str</span> macroname.getmacro<span class=p>(</span><span class=fq>getopt</span><span class=p>(</span>itemid <span class=n>3</span><span class=p>)</span> <span class=n>1</span><span class=p>)</span>
<span class=i>&#9;</span><span class=t>str</span> functionname.getmacro<span class=p>(</span>_error.iid <span class=n>1</span><span class=p>)</span>
<span class=i>&#9;</span><span class=fu>LogFile</span> <span class=o>F</span><span class=s>&quot;Macro {</span>macroname<span class=s>}: error in {</span>functionname<span class=s>}.[]Error description: {</span>_error.description<span class=s>}[]Error line: {</span>_error.line<span class=s>}[]&quot;</span> <span class=n>1</span></pre>
<p>&nbsp;</p>
</body>

</html>
