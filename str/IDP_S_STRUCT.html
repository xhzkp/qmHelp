<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>

<head>
<script type="text/javascript" src="../h.js"></script>

<title>getstruct, setstruct</title>

<link rel=StyleSheet href="../QM-Help.css">

</head>

<body>
<h1><A name="IDP_S_FILES"></a>Convert variable of a user-defined type to/from 
  string</h1>

<h3>Syntax</h3>

<pre class=syntax>s.<b>getstruct</b>(var <i>[</i>flags<i>]</i>)
s.<b>setstruct</b>(var<i></i> <i>[</i>flags2<i>]</i>)</pre>

<p>&nbsp;</p>

<h3>Parameters</h3>

<div class="parts">
<p> <b>s</b> - str variable.</p>

<p> <b>var </b>- variable of a <a href="../Language/IDP_TYPE.html">user-defined 
type</a>.</p>

<p> <b><a href="../Other/IDP_FLAGS.html">flags</a></b>:</p>
<table class="tflags"><col>
<tr> 
  <td>1</td>
  <td><p>Add member names. If this flag not used, the string will 
      contain only values.</p>
    </td>
</tr>
</table>
</div>
<p>&nbsp;</p>
<div class="parts">
<p> <b><a href="../Other/IDP_FLAGS.html">flags2</a></b>:</p>
<table class="tflags"><col>
<tr> 
  <td>1</td>
  <td><p>Use this flag if <b>s</b> includes member names. When using 
      this flag, the order of members in <b>s</b> is not important. Some members 
      in <b>s</b> may be missing. Some lines in <b>s</b> may be empty or contain 
      any data. This is useful when the string may be edited by the user. If 
      this flag not used, the string must contain only values, exactly as generated 
      by <span class="blue">getstruct</span> without flag 1.</p>
    </td>
</tr>
<tr> 
  <td>2</td>
  <td>Member names in the string don't have to match case.</td>
</tr>
<tr> 
  <td>4</td>
  <td>Don't clear <b>var</b> members that are missing in <b>s</b>.</td>
</tr>
<tr> 
  <td>8</td>
  <td>Error if some members are missing in <b>s</b>.</td>
</tr>
</table>
</div>
<p>&nbsp;</p><h3>Remarks</h3>

<p> <span class="blue">getstruct</span> converts and stores values of all members 
  of a variable of a user-defined type (<b>var</b>) into a single string (<b>s</b>).</p>
<p> <span class="blue">setstruct</span> extracts values from <b>s</b> (which is 
  previously generated by <span class="blue">getstruct</span> or other code) and 
  populates <b>var</b>.</p>
<p>&nbsp;</p>
<p> For example, if <b>var</b> is of a type that has two int members x and y, 
  an example of <b>s</b> may be:</p>
<p>&nbsp;</p>
<pre>10
20</pre>
<p>&nbsp;</p>
<p>If using flag 1, it will be:</p>
<p>&nbsp;</p>
<pre>x 10
y 20</pre>
<p>&nbsp;</p>
<p>Member name and value are separated by one or more spaces.</p>
<p>&nbsp;</p>
<p>The variable also can contain strings. For example, if <b>var</b> is of a type 
  that has four str members s1, s2, s3 and s4, an example of <b>s</b> may be:</p>
<p>&nbsp;</p>
<pre>s1 string1
s2 &quot;string that contains spaces[]or ''escape sequences''&quot;
s3
s4 &quot;&quot;</pre>
<p>&nbsp;</p>
<p>If a string contains spaces or characters that must be <a href="IDP_S_ESCAPE.html">escaped</a>, 
  in <b>s</b> it is or must be escaped and enclosed in double quotes, like s2 
  in the example. Otherwise enclosing is not necessary. <span class="blue">setstruct</span> 
  does not unescape strings that are not enclosed. Empty strings are like s3 in 
  the example. Zero length strings are like s4 in the example.</p>
<p>&nbsp;</p>
<p>Embedded arrays look like:</p>
<p>&nbsp;</p>
<pre>array_of_int_word_byte_long_double 2 -5 184 0
array_of_byte_also_can_be &quot;string&quot;
array_of_str[0] string1
array_of_str[1] string2
array_of_POINT[0].x 10
array_of_POINT[0].y 20
array_of_POINT[1].x 30
array_of_POINT[1].y 40</pre>
<p>&nbsp;</p>
<p>If an int/word/byte member name contains &quot;flags&quot;, <span class="blue">getstruct</span> 
  formats its value in hexadecimal format.</p>
<p>&nbsp;</p>
<p>The functions are slightly slower when using flag 1.</p>
<p>&nbsp;</p>
<p>The string generated by <span class="blue">getstruct</span> with flag 1 can 
  be passed to AddList function of <a href="../User/IDP_ISTRINGMAP.html">IStrinMap</a>. 
  Don't forget to remove quotes and unescape enclosed values.</p>
<p>&nbsp;</p>
<p>Not all types are supported. Restrictions:</p>
<ol>
  <li><b>var</b> cannot be of an intrinsic type (int, byte, word, str, lpstr, long, double), pointer, interface pointer</li>
  <li> <b>var</b> cannot contain lpstr. Cannot be or contain ARRAY, BSTR, VARIANT, pointer, 
    interface pointer.</li>
</ol>
<p> QM 2.3.2. The restriction 2 is not applied to <span class="blue">getstruct</span>. It allows you  to convert these types for debugging purposes.</p>
<p>&nbsp;</p>
<p>Added in QM 2.2.1.</p>
<p>&nbsp;</p>
<h3>Example</h3>

<pre class=cod><span class=fq>out</span>
<span class=fq>type</span> <span class=t>T1</span> <span class=t>byte</span><span class=p>'</span>x <span class=t>word</span><span class=p>'</span>y <span class=t>str</span><span class=p>'</span>s
<span class=fq>type</span> <span class=t>T2</span> <span class=t>int</span><span class=p>'</span>i <span class=t>str</span><span class=p>'</span>s <span class=t>T1</span><span class=p>'</span>t <span class=t>double</span><span class=p>'</span>d <span class=t>long</span><span class=p>'</span>k <span class=t>byte</span><span class=p>'</span>b[<span class=n>2</span>]

<span class=t>T2</span> t tt
t.i<span class=o>=-</span><span class=n>5</span>
t.s<span class=o>=</span><span class=s>&quot;''string''[]line2&quot;</span>
t.t.x<span class=o>=</span><span class=n>200</span>
t.t.y<span class=o>=</span><span class=n>50000</span>
t.t.s<span class=o>=</span><span class=s>&quot;string2&quot;</span>
t.d<span class=o>=</span><span class=n>1.55</span>
t.k<span class=o>=</span><span class=n>0x100000000</span>
t.b[<span class=n>0</span>]<span class=o>=</span><span class=n>3</span>
t.b[<span class=n>1</span>]<span class=o>=</span><span class=n>4</span>

<span class=t>str</span> s
s.<span class=fq>getstruct</span><span class=p>(</span>t <span class=n>1</span><span class=p>)</span>
<span class=fq>out</span> s
<span class=fq>out</span> <span class=s>&quot;---&quot;</span>
s.<span class=fq>setstruct</span><span class=p>(</span>tt <span class=n>1</span><span class=p>)</span>

<span class=fq>out</span> tt.i
<span class=fq>out</span> tt.s
<span class=fq>out</span> tt.t.x
<span class=fq>out</span> tt.t.y
<span class=fq>out</span> tt.t.s
<span class=fq>out</span> tt.d
<span class=fq>out</span> tt.k
<span class=fq>out</span> tt.b[<span class=n>0</span>]
<span class=fq>out</span> tt.b[<span class=n>1</span>]

<span class=c> Output:</span>
<span class=c> i -5</span>
<span class=c> s &quot;''string''[]line2&quot;</span>
<span class=c> t.x 200</span>
<span class=c> t.y 50000</span>
<span class=c> t.s string2</span>
<span class=c> d 1.55</span>
<span class=c> k 4294967296</span>
<span class=c> b[0] 3</span>
<span class=c> b[1] 4</span>
<span class=c> </span>
<span class=c> ---</span>
<span class=c> -5</span>
<span class=c> &quot;string&quot;</span>
<span class=c> line2</span>
<span class=c> 200</span>
<span class=c> 50000</span>
<span class=c> string2</span>
<span class=c> 1.55</span>
<span class=c> 4294967296</span>
<span class=c> 3</span>
<span class=c> 4</span>
</pre>
<p>&nbsp;</p>
</body>

</html>
